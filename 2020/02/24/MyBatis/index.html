<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="大白小怪兽">
    
    <title>
        
            MyBatis入门 |
        
        大白小怪兽
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/images/blog.png">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"blog.sky123.top","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/blog.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"乐于有所得，苦于无知"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.0"};
    KEEP.language_ago = undefined;
  </script>
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                大白小怪兽
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">MyBatis入门</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">大白小怪兽</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2020-02-24 14:53:47
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Mybatis%E6%A1%86%E6%9E%B6/">Mybatis框架</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/JavaWeb/">JavaWeb</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <hr>
<p><img src="http://img.sky123.top/cover/tree.png"></p>
<hr>
<h3 id="1-MyBatis框架概述"><a href="#1-MyBatis框架概述" class="headerlink" title="1. MyBatis框架概述"></a>1. MyBatis框架概述</h3><p>mybatis 是一个优秀的基于 java 的持久层框架</p>
<ol>
<li>它内部封装了 jdbc，使开发者只需要关注 sql 语句本身，而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。</li>
<li>mybatis 通过 xml 或注解的方式将要执行的各种 statement 配置起来，并通过 java 对象和 statement 中<br>sql 的动态参数进行映射生成最终执行的 sql 语句，最后由 mybatis 框架执行 sql 并将结果映射为 java 对象并<br>返回。</li>
<li>采用 ORM 思想解决了实体和数据库映射的问题，对 jdbc 进行了封装，屏蔽了 jdbc api 底层访问细节，使我<br>们不用与 jdbc api 打交道，就可以完成对数据库的持久化操作。</li>
</ol>
<h3 id="2-搭建MyBatis框架环境"><a href="#2-搭建MyBatis框架环境" class="headerlink" title="2. 搭建MyBatis框架环境"></a>2. 搭建MyBatis框架环境</h3><h4 id="2-1-创建maven工程"><a href="#2-1-创建maven工程" class="headerlink" title="2.1. 创建maven工程"></a>2.1. 创建maven工程</h4><hr>
<img src="http://img.sky123.top/mybatis01/image-20200528100131635.png" alt="image-20200528100131635">

<hr>
<img src="http://img.sky123.top/mybatis01/image-20200528100240919.png" alt="image-20200528100240919">

<hr>
<img src="http://img.sky123.top/mybatis01/image-20200528100320103.png" alt="image-20200528100320103">

<hr>
<h4 id="2-2-导入依赖"><a href="#2-2-导入依赖" class="headerlink" title="2.2. 导入依赖"></a>2.2. 导入依赖</h4><pre><code class="xml">&lt;dependency&gt;
&lt;groupId&gt;org.mybatis&lt;/groupId&gt;
&lt;artifactId&gt;mybatis&lt;/artifactId&gt;
&lt;version&gt;3.4.5&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;version&gt;5.1.6&lt;/version&gt;
&lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="2-3-编写实体类（如：User类）持久层接口（如：UserDao-UserMapper）"><a href="#2-3-编写实体类（如：User类）持久层接口（如：UserDao-UserMapper）" class="headerlink" title="2.3. 编写实体类（如：User类）持久层接口（如：UserDao/UserMapper）"></a>2.3. 编写实体类（如：User类）持久层接口（如：UserDao/UserMapper）</h4><h4 id="2-4-编写接口的映射文件"><a href="#2-4-编写接口的映射文件" class="headerlink" title="2.4. 编写接口的映射文件"></a>2.4. 编写接口的映射文件</h4><hr>
<img src="http://img.sky123.top/mybatis01/image-20200528100817522.png" alt="image-20200528100817522">

<hr>
<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;mapper namespace="com.itheima.dao.IUserDao"&gt;
&lt;!-- 配置查询所有操作 --&gt;
&lt;select id="findAll" resultType="com.itheima.domain.User"&gt;
select * from user
&lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<h4 id="2-5-编写核心配置文件-SqlMapConfig-xml-resources目录下"><a href="#2-5-编写核心配置文件-SqlMapConfig-xml-resources目录下" class="headerlink" title="2.5. 编写核心配置文件 SqlMapConfig.xml  (resources目录下)"></a>2.5. 编写核心配置文件 SqlMapConfig.xml  (resources目录下)</h4><pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE configuration
PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
&lt;!-- 配置 mybatis 的环境 --&gt;
&lt;environments default="mysql"&gt;
&lt;!-- 配置 mysql 的环境 --&gt;
&lt;environment id="mysql"&gt;
&lt;!-- 配置事务的类型 --&gt;
&lt;transactionManager type="JDBC"&gt;&lt;/transactionManager&gt;
&lt;!-- 配置连接数据库的信息：用的是数据源(连接池) --&gt;
&lt;dataSource type="POOLED"&gt;
&lt;property name="driver" value="com.mysql.jdbc.Driver"/&gt;
&lt;property name="url" value="jdbc:mysql://localhost:3306/ee50"/&gt;
&lt;property name="username" value="root"/&gt;
&lt;property name="password" value="1234"/&gt;
&lt;/dataSource&gt;
&lt;/environment&gt;
&lt;/environments&gt;
&lt;!-- 告知 mybatis 映射配置的位置 resource表明其在resources文件上 --&gt;
&lt;mappers&gt;
&lt;mapper resource="com/itheima/dao/IUserDao.xml"/&gt;
&lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<h3 id="3-MyBatis框架原理"><a href="#3-MyBatis框架原理" class="headerlink" title="3. MyBatis框架原理"></a>3. MyBatis框架原理</h3><pre><code class="java">public class MybatisTest {
public static void main(String[] args)throws Exception {
//1.读取配置文件
InputStream in = Resources.getResourceAsStream("SqlMapConfig.xml");
//2.创建 SqlSessionFactory 的构建者对象
SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
//3.使用构建者创建工厂对象 SqlSessionFactory
SqlSessionFactory factory = builder.build(in);
//4.使用 SqlSessionFactory 生产 SqlSession 对象
SqlSession session = factory.openSession();
//5.使用 SqlSession 创建 dao 接口的代理对象
IUserDao userDao = session.getMapper(IUserDao.class);
//6.使用代理对象执行查询所有方法
List&lt;User&gt; users = userDao.findAll();
for(User user : users) {
System.out.println(user);
}
//7.释放资源
session.close();
in.close();
}
}
</code></pre>
<h4 id="3-1-构建者模式"><a href="#3-1-构建者模式" class="headerlink" title="3.1 构建者模式"></a>3.1 构建者模式</h4><hr>
<p><img src="http://img.sky123.top/mybatis01/image-20200528140047789.png" alt="image-20200528140047789"></p>
<hr>
<h4 id="3-2-工厂模式"><a href="#3-2-工厂模式" class="headerlink" title="3.2 工厂模式"></a>3.2 工厂模式</h4><hr>
<img src="http://img.sky123.top/mybatis01/image-20200528143748636.png" alt="image-20200528143748636">

<hr>
<h3 id="4-补充：基于注解的Mybatis"><a href="#4-补充：基于注解的Mybatis" class="headerlink" title="4. 补充：基于注解的Mybatis"></a>4. 补充：基于注解的Mybatis</h3><h4 id="修改Dao-SqlMapConfig-xml-并移除Dao-xml"><a href="#修改Dao-SqlMapConfig-xml-并移除Dao-xml" class="headerlink" title="修改Dao,SqlMapConfig.xml,并移除Dao.xml"></a>修改Dao,SqlMapConfig.xml,并移除Dao.xml</h4><pre><code class="java">public interface IUserDao {
/**
* 查询所有用户
* @return
*/
@Select("select * from user")
List&lt;User&gt; findAll();
}
</code></pre>
<pre><code class="xml">&lt;!-- 告知 mybatis 映射配置的位置 --&gt;
&lt;mappers&gt;
&lt;mapper class="com.itheima.dao.IUserDao"/&gt;
&lt;/mappers&gt;
</code></pre>
<h3 id="5-Mybatis的参数映射"><a href="#5-Mybatis的参数映射" class="headerlink" title="5. Mybatis的参数映射"></a>5. Mybatis的参数映射</h3><h4 id="5-1-parameterType-配置参数"><a href="#5-1-parameterType-配置参数" class="headerlink" title="5.1 parameterType 配置参数"></a>5.1 parameterType 配置参数</h4><p>实体类型：全类名</p>
<p>基本类型和String ：直接写类名称（首字母大写），也可以使用别名（首字母小写）</p>
<h3 id="6-Mybatis-的输出结果封装"><a href="#6-Mybatis-的输出结果封装" class="headerlink" title="6. Mybatis 的输出结果封装"></a>6. Mybatis 的输出结果封装</h3><h4 id="6-1-resultType"><a href="#6-1-resultType" class="headerlink" title="6.1 resultType"></a>6.1 resultType</h4><p>实体类型：全类名，<strong>实体类中的属性名称必须和查询语句中的列名保持一致，否则无法实现封装</strong>  </p>
<p>基本类型和String ：直接写类名称（首字母大写），也可以使用别名（首字母小写）</p>
<h4 id="6-2-resultMap"><a href="#6-2-resultMap" class="headerlink" title="6.2 resultMap"></a>6.2 resultMap</h4><p>resultMap 标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。  </p>
<pre><code class="xml">&lt;!-- 建立 User 实体和数据库表的对应关系
type 属性：指定实体类的全限定类名
id 属性：给定一个唯一标识，是给查询 select 标签引用用的。
--&gt;
&lt;resultMap type="com.itheima.domain.User" id="userMap"&gt;
&lt;id column="id" property="userId"/&gt;
&lt;result column="username" property="userName"/&gt;
&lt;result column="sex" property="userSex"/&gt;
&lt;result column="address" property="userAddress"/&gt;
&lt;result column="birthday" property="userBirthday"/&gt;
&lt;/resultMap&gt;
id 标签：用于指定主键字段
result 标签：用于指定非主键字段
column 属性：用于指定数据库列名
property 属性：用于指定实体类属性名称
</code></pre>
<h3 id="7-SqlMapConfig-xml配置文件"><a href="#7-SqlMapConfig-xml配置文件" class="headerlink" title="7. SqlMapConfig.xml配置文件"></a>7. SqlMapConfig.xml配置文件</h3><pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE configuration
PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
&lt;/configuration&gt;
</code></pre>
<h4 id="7-1-typeAliases（类型别名）"><a href="#7-1-typeAliases（类型别名）" class="headerlink" title="7.1 typeAliases（类型别名）"></a>7.1 typeAliases（类型别名）</h4><p>在 <configuration></configuration>中配置</p>
<pre><code class="xml">&lt;typeAliases&gt;
&lt;!-- 单个别名定义 --&gt;
&lt;typeAlias alias="user" type="com.itheima.domain.User"/&gt;
&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;
&lt;package name="com.itheima.domain"/&gt;
&lt;package name="其它包"/&gt;
&lt;/typeAliases&gt;
</code></pre>
<h4 id="7-2-mappers（映射器）"><a href="#7-2-mappers（映射器）" class="headerlink" title="7.2 mappers（映射器）"></a>7.2 mappers（映射器）</h4><pre><code class="xml">&lt;mappers&gt;
    
&lt;!-- 注册指定包下的所有 mapper 接口,直接写包名，注意目录结构要相同，接口名和配置文件名相同--&gt;
&lt;package name="com.hnust.dao"/&gt;
    
&lt;!-- 映射某个配置文件，注意目录结构要相同，接口名和配置文件名相同--&gt;
&lt;mapper resource="com.hnust/dao/UserDao.xml"/&gt;
    
&lt;!--用于注解 --&gt;
&lt;mapper class="cn.hnust.UserDAO"/&gt;
    
&lt;/mappers&gt;
</code></pre>
<h3 id="8-Mybatis-的动态-SQL-语句"><a href="#8-Mybatis-的动态-SQL-语句" class="headerlink" title="8. Mybatis 的动态 SQL 语句"></a>8. Mybatis 的动态 SQL 语句</h3><h4 id="8-1-动态-SQL-之if标签"><a href="#8-1-动态-SQL-之if标签" class="headerlink" title="8.1 动态 SQL 之if标签"></a>8.1 动态 SQL 之if标签</h4><pre><code class="xml">&lt;select id="findByUser" resultType="user" parameterType="user"&gt;
    
select * from user where 1=1
    
&lt;if test="username!=null and username != '' "&gt;
and username like #{username}
&lt;/if&gt;
    
&lt;if test="address != null"&gt;
and address like #{address}
&lt;/if&gt;
    
&lt;/select&gt;
</code></pre>
<h4 id="8-2-动态-SQL-之where标签"><a href="#8-2-动态-SQL-之where标签" class="headerlink" title="8.2 动态 SQL 之where标签"></a>8.2 动态 SQL 之where标签</h4><pre><code class="xml">&lt;!-- 根据用户信息查询  if标签的 "and" 不能不写 --&gt;
&lt;select id="findByUser" resultType="user" parameterType="user"&gt;
    
select * from user
    
&lt;where&gt;
    
&lt;if test="username!=null and username != '' "&gt;
and username like #{username}
&lt;/if&gt;
    
&lt;if test="address != null"&gt;
and address like #{address}
&lt;/if&gt;
    
&lt;/where&gt;
    
&lt;/select&gt;
</code></pre>
<h4 id="8-3-动态标签之foreach标签"><a href="#8-3-动态标签之foreach标签" class="headerlink" title="8.3 动态标签之foreach标签"></a>8.3 动态标签之foreach标签</h4><p>传入多个 id 查询用户信息，用下边两个 sql 实现：</p>
<pre><code class="sql">SELECT * FROM USERS WHERE username LIKE '%zhangruwang%' AND (id =10 OR id =89 OR id=16)
SELECT * FROM USERS WHERE username LIKE '%zhangruwang%' AND id IN (10,89,16)
</code></pre>
<p>这样我们在进行范围查询时，就要将一个集合中的值，作为参数动态添加进来。  注意不能直接用集合作为参数，只能将它包装在一个对象中（如   Queryvo  queryvo 中包含一个   **List<integer> ids **  ）</integer></p>
<pre><code class="xml">&lt;!-- 查询所有用户在 id 的集合之中 --&gt;
&lt;select id="findInIds" resultType="user" parameterType="queryvo"&gt;
&lt;!-- select * from user where id in (1,2,3,4,5); --&gt;
select * from user 
&lt;where&gt;
    
&lt;if test="ids != null and ids.size() &gt; 0"&gt;
    
&lt;foreach collection="ids" open="id in ( " close=")" item="uid"
separator=","&gt;
#{uid}
&lt;/foreach&gt;
    
&lt;/if&gt;
&lt;/where&gt;
&lt;/select&gt;
SQL 语句：
select 字段 from user where id in (?)
&lt;foreach&gt;标签用于遍历集合，它的属性：
collection:代表要遍历的集合元素，注意编写时不要写#{}
open:代表语句的开始部分
close:代表结束部分
item:代表遍历集合的每个元素，生成的变量名
sperator:代表分隔符
</code></pre>
<h4 id="8-4-include标签抽取重复sql"><a href="#8-4-include标签抽取重复sql" class="headerlink" title="8.4 include标签抽取重复sql"></a>8.4 include标签抽取重复sql</h4><pre><code class="xml">&lt;!-- 抽取重复的语句代码片段 --&gt;
&lt;sql id="defaultSql"&gt;
select * from user
&lt;/sql&gt;

&lt;!-- 配置查询所有操作 --&gt;
&lt;select id="findAll" resultType="user"&gt;
&lt;include refid="defaultSql"&gt;&lt;/include&gt;
&lt;/select&gt;
</code></pre>
<h3 id="9-Mybatis-多表查询"><a href="#9-Mybatis-多表查询" class="headerlink" title="9. Mybatis 多表查询"></a>9. Mybatis 多表查询</h3><h4 id="9-1-一对一查询-多对一"><a href="#9-1-一对一查询-多对一" class="headerlink" title="9.1 一对一查询(多对一)"></a>9.1 一对一查询(多对一)</h4><p>因为一个账户信息只能供某个用户使用，所以从查询账户信息出发关联查询用户信息为一对一查询。如<br>果从用户信息出发查询用户下的账户信息则为一对多查询，因为一个用户可以有多个账户。  </p>
<pre><code class="sql">SELECT account.*,user.username,user.address
FROM account,user
WHERE account.uid = user.id
</code></pre>
<p>第一种方式</p>
<pre><code class="xml">定义了一个 AccountUser 类用于接收结果

&lt;select id="findAll" resultType="accountuser"&gt;
select a.*,u.username,u.address from account a,user u where a.uid =u.id;
&lt;/select&gt;
</code></pre>
<p>第二种方式</p>
<pre><code class="xml">在 Account 类中加入 User 类的对象作为 Account 类的一个属性。

&lt;resultMap type="account" id="accountMap"&gt;
    
&lt;id column="aid" property="id"/&gt;
&lt;result column="uid" property="uid"/&gt;
&lt;result column="money" property="money"/&gt;
    
&lt;!-- 它是用于指定从表方的引用实体属性的 --&gt;
&lt;association property="user" javaType="user"&gt;
    
&lt;id column="id" property="id"/&gt;
&lt;result column="username" property="username"/&gt;
&lt;result column="sex" property="sex"/&gt;
&lt;result column="birthday" property="birthday"/&gt;
&lt;result column="address" property="address"/&gt;
    
&lt;/association&gt;
    
&lt;/resultMap&gt;
</code></pre>
<pre><code class="xml">&lt;select id="findAll" resultMap="accountMap"&gt;
select u.*,a.id as aid,a.uid,a.money from account a,user u where a.uid =u.id;
&lt;/select&gt;
</code></pre>
<h4 id="9-2-一对多查询"><a href="#9-2-一对多查询" class="headerlink" title="9.2 一对多查询"></a>9.2 一对多查询</h4><p>用户信息和他的账户信息为一对多关系，并且查询过程中如果用户没有账户信息，此时也要将用户信息<br>查询出来，我们想到了左外连接查询比较合适  </p>
<pre><code class="sql">SELECT u.*, acc.id id,acc.uid,acc.money
FROM user u
LEFT JOIN account acc ON u.id = acc.uid
</code></pre>
<pre><code class="xml">User 类加入 List&lt;Account&gt;  

&lt;resultMap type="user" id="userMap"&gt;
&lt;id column="id" property="id"&gt;&lt;/id&gt;
&lt;result column="username" property="username"/&gt;
&lt;result column="address" property="address"/&gt;
&lt;result column="sex" property="sex"/&gt;
&lt;result column="birthday" property="birthday"/&gt;
    
&lt;!-- collection 是用于建立一对多中集合属性的对应关系  ofType 用于指定集合元素的数据类型--&gt;
&lt;collection property="accounts" ofType="account"&gt;
&lt;id column="aid" property="id"/&gt;
&lt;result column="uid" property="uid"/&gt;
&lt;result column="money" property="money"/&gt;
&lt;/collection&gt;
    
&lt;/resultMap&gt;

&lt;!-- 配置查询所有操作 --&gt;
&lt;select id="findAll" resultMap="userMap"&gt;
select u.*,a.id as aid ,a.uid,a.money from user u left outer join account
a on u.id =a.uid
&lt;/select&gt;

collection部分定义了用户关联的账户信息。表示关联查询结果集
property="accounts"：关联查询的结果集存储在 User 对象的上哪个属性。
ofType="account"：指定关联查询的结果集中的对象类型即List中的对象类型。此处可以使用别名，也可以使用全限定名。
</code></pre>
<h4 id="9-3-多对多查询"><a href="#9-3-多对多查询" class="headerlink" title="9.3 多对多查询"></a>9.3 多对多查询</h4><p>查询角色我们需要用到Role表，但角色分配的用户的信息我们并不能直接找到用户信息，而是要通过中<br>间表(USER_ROLE 表)才能关联到用户信息。  </p>
<pre><code class="sql">SELECT r.*,u.id uid,u.username username,u.birthday birthday,u.sex sex,u.address address
FROM ROLE r INNER JOIN USER_ROLE ur
ON ( r.id = ur.rid)
INNER JOIN USER u
ON (ur.uid = u.id)
</code></pre>
<pre><code class="xml">Role 类加入 List&lt;User&gt;  
    
&lt;!--定义 role 表的 ResultMap--&gt;
&lt;resultMap id="roleMap" type="role"&gt;
    
&lt;id property="roleId" column="rid"&gt;&lt;/id&gt;
&lt;result property="roleName" column="role_name"&gt;&lt;/result&gt;
&lt;result property="roleDesc" column="role_desc"&gt;&lt;/result&gt;
    
&lt;collection property="users" ofType="user"&gt;
&lt;id column="id" property="id"&gt;&lt;/id&gt;
&lt;result column="username" property="username"&gt;&lt;/result&gt;
&lt;result column="address" property="address"&gt;&lt;/result&gt;
&lt;result column="sex" property="sex"&gt;&lt;/result&gt;
&lt;result column="birthday" property="birthday"&gt;&lt;/result&gt;
&lt;/collection&gt;
    
&lt;/resultMap&gt;
    
    
&lt;!--查询所有--&gt;
&lt;select id="findAll" resultMap="roleMap"&gt;
select u.*,r.id as rid,r.role_name,r.role_desc from role r
left outer join user_role ur on r.id = ur.rid
left outer join user u on u.id = ur.uid
&lt;/select&gt;
</code></pre>
<h3 id="10-Mybatis-延迟加载策略"><a href="#10-Mybatis-延迟加载策略" class="headerlink" title="10. Mybatis 延迟加载策略"></a>10. Mybatis 延迟加载策略</h3><p>延迟加载：就是在需要用到数据时才进行加载，不需要用到数据时就不加载数据。延迟加载也称懒加载.<br>好处： 先从单表查询，需要时再从关联表去关联查询，大大提高数据库性能，因为查询单表要比关联查询多zhangruwang表速度要快。  </p>
<p>坏处：因为只有当需要用到数据时，才会进行数据库查询，这样在大批量数据查询时，因为查询工作也要消耗时间，所以可能造成用户等待时间变长，造成用户体验下降。  </p>
<pre><code class="xml">需先在 SqlMapConfig.xml 中配置开启功能
&lt;settings&gt;
&lt;setting name="lazyLoadingEnabled" value="true"/&gt;
&lt;setting name="aggressiveLazyLoading" value="false"/&gt;
&lt;/settings&gt;
</code></pre>
<h4 id="10-1-使用-assocation-实现延迟加载"><a href="#10-1-使用-assocation-实现延迟加载" class="headerlink" title="10.1 使用 assocation 实现延迟加载"></a>10.1 使用 assocation 实现延迟加载</h4><p>查询账户信息同时查询用户信息  Account 中有 User 类</p>
<pre><code class="xml">AccountDao.xml
List&lt;Account&gt; findAll();

&lt;!-- 建立对应关系 --&gt;
&lt;resultMap type="account" id="accountMap"&gt;
&lt;id column="aid" property="id"/&gt;
&lt;result column="uid" property="uid"/&gt;
&lt;result column="money" property="money"/&gt;
    
&lt;!-- 它是用于指定从表方的引用实体属性的 --&gt;
    select： 填写我们要调用的 select 映射的 id
    column ： 填写我们要传递给 select 映射的参数
&lt;association property="user" javaType="user" select="com.itheima.dao.IUserDao.findById" column="uid"&gt;
&lt;/association&gt;
    
&lt;/resultMap&gt;

&lt;select id="findAll" resultMap="accountMap"&gt;
select * from account
&lt;/select&gt;
</code></pre>
<pre><code class="xml">UserDao.xml
User findById(Integer userId);

&lt;!-- 根据 id 查询 --&gt;
&lt;select id="findById" resultType="user" parameterType="int" &gt;
select * from user where id = #{uid}
&lt;/select&gt;
</code></pre>
<h4 id="10-2-使用-Collection-实现延迟加载"><a href="#10-2-使用-Collection-实现延迟加载" class="headerlink" title="10.2 使用 Collection 实现延迟加载"></a>10.2 使用 Collection 实现延迟加载</h4><p>完成加载用户对象时，查询该用户所拥有的账户信息。  </p>
<p>User 中有 List<account></account></p>
<pre><code class="xml">UserDao.xml

&lt;resultMap type="user" id="userMap"&gt;
    
&lt;id column="id" property="id"&gt;&lt;/id&gt;
&lt;result column="username" property="username"/&gt;
&lt;result column="address" property="address"/&gt;
&lt;result column="sex" property="sex"/&gt;
&lt;result column="birthday" property="birthday"/&gt;
    
&lt;!-- collection 是用于建立一对多中集合属性的对应关系
ofType 用于指定集合元素的数据类型
select 是用于指定查询账户的唯一标识（账户的 dao 全限定类名加上方法名称）
column 是用于指定使用哪个字段的值作为条件查询
--&gt;
&lt;collection property="accounts" ofType="account"
select="com.itheima.dao.IAccountDao.findByUid"
column="id"&gt;
    
&lt;/collection&gt;
&lt;/resultMap&gt;

&lt;!-- 配置查询所有操作 --&gt;
&lt;select id="findAll" resultMap="userMap"&gt;
select * from user
&lt;/select&gt;
</code></pre>
<pre><code class="xml">AccountDao.xml

&lt;!-- 根据用户 id 查询账户信息 --&gt;
&lt;select id="findByUid" resultType="account" parameterType="int"&gt;
select * from account where uid = #{uid}
&lt;/select&gt;
</code></pre>
<h3 id="11-Mybatis-缓存"><a href="#11-Mybatis-缓存" class="headerlink" title="11. Mybatis 缓存"></a>11. Mybatis 缓存</h3><p>提供了缓存策略，通过缓存策略来减少数据库的查询次数， 从而提高性能。Mybatis 中缓存分为一级缓存，二级缓存。  </p>
<hr>
<img src="http://img.sky123.top/mybatis01/image-20200528174434282.png" alt="image-20200528174434282">

<hr>
<h4 id="11-1-一级缓存"><a href="#11-1-一级缓存" class="headerlink" title="11. 1 一级缓存"></a>11. 1 一级缓存</h4><p>一级缓存是 SqlSession 范围的缓存，当调用 SqlSession 的修改，添加，删除， commit()， close()等 方法时，就会清空一级缓存  </p>
<hr>
<img src="http://img.sky123.top/mybatis01/image-20200528175000842.png" alt="image-20200528175000842">

<hr>
<h4 id="11-2-二级缓存"><a href="#11-2-二级缓存" class="headerlink" title="11.2 二级缓存"></a>11.2 二级缓存</h4><p>二级缓存是 mapper 映射级别的缓存，多个 SqlSession 去操作同一个 Mapper 映射的 sql 语句，多个SqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。  </p>
<hr>
<img src="http://img.sky123.top/mybatis01/image-20200528175101555.png" alt="image-20200528175101555">

<hr>
<h5 id="二级缓存的开启与关闭"><a href="#二级缓存的开启与关闭" class="headerlink" title="二级缓存的开启与关闭"></a>二级缓存的开启与关闭</h5><p>在 SqlMapConfig.xml 文件开启二级缓存  </p>
<pre><code class="xml">&lt;settings&gt;
&lt;!-- 开启二级缓存的支持 --&gt;
&lt;setting name="cacheEnabled" value="true"/&gt;
&lt;/settings&gt;
因为 cacheEnabled 的取值默认就为 true，所以这一步可以省略不配置。为 true 代表开启二级缓存；为
false 代表不开启二级缓存。
</code></pre>
<p>配置相关的 Mapper 映射文件  </p>
<pre><code class="xml">&lt;cache&gt;标签表示当前这个 mapper 映射将使用二级缓存，区分的标准就看 mapper 的 namespace 值。

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.itheima.dao.IUserDao"&gt;
&lt;!-- 开启二级缓存的支持 --&gt;
&lt;cache&gt;&lt;/cache&gt;
&lt;/mapper&gt;
</code></pre>
<p>配置 statement 上面的 useCache 属性  </p>
<pre><code class="xml">&lt;!-- 根据 id 查询 --&gt;
&lt;select id="findById" resultType="user" parameterType="int" useCache="true"&gt;
select * from user where id = #{uid}
&lt;/select&gt;

将 UserDao.xml 映射文件中的&lt;select&gt;标签中设置 useCache=”true”代表当前这个 statement 要使用
二级缓存，如果不使用二级缓存可以设置为 false。
注意： 针对每次查询都需要最新的数据 sql，要设置成 useCache=false，禁用二级缓存。
当我们在使用二级缓存时，所缓存的类一定要实现 java.io.Serializable 接口，这种就可以使用序列化方式来保存对象。
</code></pre>
<h3 id="12-Mybatis-注解开发"><a href="#12-Mybatis-注解开发" class="headerlink" title="12. Mybatis 注解开发"></a>12. Mybatis 注解开发</h3><pre><code class="java">@Insert:实现新增
@Update:实现更新
@Delete:实现删除
@Select:实现查询
@Result:实现结果集封装
@Results:可以与@Result 一起使用，封装多个结果集
@ResultMap:实现引用@Results 定义的封装
@One:实现一对一结果集封装
@Many:实现一对多结果集封装
@SelectProvider: 实现动态 SQL 映射
@CacheNamespace:实现注解二级缓存的使用
</code></pre>
<pre><code class="Java">//UserDao中

@Select("select * from user")
@Results(id="userMap",
value= {
@Result(id=true,column="id",property="userId"),
@Result(column="username",property="userName"),
@Result(column="sex",property="userSex"),
@Result(column="address",property="userAddress"),
@Result(column="birthday",property="userBirthday")
})
List&lt;User&gt; findAll();


@Select("select * from user where id = #{uid} ")
@ResultMap("userMap")
User findById(Integer userId);


@Insert("insert into
user(username,sex,birthday,address)values(#{username},#{sex},#{birthday},#{address}
)")
@SelectKey(keyColumn="id",keyProperty="id",resultType=Integer.class,before =
false, statement = { "select last_insert_id()" })
int saveUser(User user);
</code></pre>
<h4 id="获取插入数据的-id"><a href="#获取插入数据的-id" class="headerlink" title="获取插入数据的 id"></a>获取插入数据的 id</h4><pre><code class="xml">&lt;insert id="saveUser" parameterType="USER"&gt;
&lt;!-- 配置保存时获取插入的 id --&gt;
&lt;selectKey keyColumn="id" keyProperty="id" resultType="int"&gt;
select last_insert_id();
&lt;/selectKey&gt;
insert into user(username,birthday,sex,address)
values(#{username},#{birthday},#{sex},#{address})
&lt;/insert&gt;
</code></pre>
<pre><code class="java">/**
* 查询所有账户，采用延迟加载的方式查询账户的所属用户
* @return
*/
@Select("select * from account")
@Results(id="accountMap",
value= {
@Result(id=true,column="id",property="id"),
@Result(column="uid",property="uid"),
@Result(column="money",property="money"),
@Result(column="uid",
property="user",
one=@One(select="com.itheima.dao.IUserDao.findById",
fetchType=FetchType.LAZY)
)
})
List&lt;Account&gt; findAll();
</code></pre>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/02/23/hello-world/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Hello World</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">大白小怪兽</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.0</a>
        </div>
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>



<script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script>




    <script src="/js/code-copy.js"></script>




<div class="post-scripts">
    
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
